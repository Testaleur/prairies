(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))u(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const m of s.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&u(m)}).observe(document,{childList:!0,subtree:!0});function p(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function u(r){if(r.ep)return;r.ep=!0;const s=p(r);fetch(r.href,s)}})();function j(c,a,p,u){const r="/prairies/",s={"01":"Auvergne-Rhône-Alpes","03":"Auvergne-Rhône-Alpes","07":"Auvergne-Rhône-Alpes",15:"Auvergne-Rhône-Alpes",26:"Auvergne-Rhône-Alpes",38:"Auvergne-Rhône-Alpes",42:"Auvergne-Rhône-Alpes",43:"Auvergne-Rhône-Alpes",63:"Auvergne-Rhône-Alpes",69:"Auvergne-Rhône-Alpes",73:"Auvergne-Rhône-Alpes",74:"Auvergne-Rhône-Alpes",21:"Bourgogne-Franche-Comté",25:"Bourgogne-Franche-Comté",39:"Bourgogne-Franche-Comté",58:"Bourgogne-Franche-Comté",70:"Bourgogne-Franche-Comté",71:"Bourgogne-Franche-Comté",89:"Bourgogne-Franche-Comté",90:"Bourgogne-Franche-Comté",22:"Bretagne",29:"Bretagne",35:"Bretagne",56:"Bretagne",18:"Centre-Val de Loire",28:"Centre-Val de Loire",36:"Centre-Val de Loire",37:"Centre-Val de Loire",41:"Centre-Val de Loire",45:"Centre-Val de Loire","2A":"Corse","2B":"Corse","08":"Grand Est",10:"Grand Est",51:"Grand Est",52:"Grand Est",54:"Grand Est",55:"Grand Est",57:"Grand Est",67:"Grand Est",68:"Grand Est",88:"Grand Est","02":"Hauts-de-France",59:"Hauts-de-France",60:"Hauts-de-France",62:"Hauts-de-France",80:"Hauts-de-France",75:"Île-de-France",77:"Île-de-France",78:"Île-de-France",91:"Île-de-France",92:"Île-de-France",93:"Île-de-France",94:"Île-de-France",95:"Île-de-France",14:"Normandie",27:"Normandie",50:"Normandie",61:"Normandie",76:"Normandie",16:"Nouvelle-Aquitaine",17:"Nouvelle-Aquitaine",19:"Nouvelle-Aquitaine",23:"Nouvelle-Aquitaine",24:"Nouvelle-Aquitaine",33:"Nouvelle-Aquitaine",40:"Nouvelle-Aquitaine",47:"Nouvelle-Aquitaine",64:"Nouvelle-Aquitaine",79:"Nouvelle-Aquitaine",86:"Nouvelle-Aquitaine",87:"Nouvelle-Aquitaine","09":"Occitanie",11:"Occitanie",12:"Occitanie",30:"Occitanie",31:"Occitanie",32:"Occitanie",34:"Occitanie",46:"Occitanie",48:"Occitanie",65:"Occitanie",66:"Occitanie",81:"Occitanie",82:"Occitanie",44:"Pays de la Loire",49:"Pays de la Loire",53:"Pays de la Loire",72:"Pays de la Loire",85:"Pays de la Loire","04":"Provence-Alpes-Côte d'Azur","05":"Provence-Alpes-Côte d'Azur","06":"Provence-Alpes-Côte d'Azur",13:"Provence-Alpes-Côte d'Azur",83:"Provence-Alpes-Côte d'Azur",84:"Provence-Alpes-Côte d'Azur"};let m=null,z=null;Promise.all([d3.json(`${r}regions.geojson`),d3.json(`${r}departements.geojson`),d3.json(`${r}arrondissements.geojson`),d3.csv(`${r}data.csv`)]).then(([F,N,f,G])=>{const l=new Map(G.map(e=>[e.nom.trim(),+e.value])),O=F.features.map(e=>e.properties.nom.trim()),h=d3.max(O,e=>l.get(e))||100,A=d3.geoConicConformal().center([2.2137,46.2276]).scale(3e3).translate([p/2,u/2]),k=d3.geoPath().projection(A),L=c.append("g"),v=L.append("g").attr("class","arr-layer"),P=L.append("g").attr("class","depts-layer"),w=L.append("g").attr("class","regions-layer"),q=d3.zoom().scaleExtent([1,40]).on("zoom",e=>L.attr("transform",e.transform)),g=d3.select("#map-container").append("button").attr("id","back-button").text("← Retour à la France").style("position","absolute").style("top","70px").style("left","20px").style("display","none").style("z-index","1000").on("click",M);function M(){const e=g.text();e==="← Retour au Département"?(g.text("← Retour à la Région"),v.selectAll("path").transition().duration(500).style("opacity",1),x(z,.8)):e==="← Retour à la Région"?(g.text("← Retour à la France"),v.selectAll("path").remove(),B(m.properties.nom),x(m,.8)):e==="← Retour à la France"&&(g.style("display","none"),v.selectAll("path").remove(),P.selectAll("path").remove(),C(h,"Valeur par Région"),w.selectAll("path").transition().duration(500).style("opacity",1).style("pointer-events","all"),c.transition().duration(750).call(q.transform,d3.zoomIdentity),m=null)}function x(e,o=.8){const[[i,d],[y,t]]=k.bounds(e);c.transition().duration(750).call(q.transform,d3.zoomIdentity.translate(p/2,u/2).scale(Math.min(40,o/Math.max((y-i)/p,(t-d)/u))).translate(-(i+y)/2,-(d+t)/2))}function $(e,o){m=o,g.style("display","block").text("← Retour à la France"),e&&e.stopPropagation(),x(o,.7),B(o.properties.nom)}function T(e,o){e.stopPropagation(),z=o;const i=o.properties.code;g.style("display","block").text("← Retour à la Région");const d=f.features.filter(n=>n.properties.code.startsWith(i)),y=d3.max(d,n=>l.get(n.properties.nom.trim()))||1,t=d3.scaleSequential().domain([0,y]).interpolator(d3.interpolateGreens);C(y,"Valeur par Arrond."),x(o,.8),P.selectAll("path").style("pointer-events","none").transition().duration(500).style("opacity",0),v.selectAll("path").data(d,n=>n.properties.nom).enter().append("path").attr("d",k).style("vector-effect","non-scaling-stroke").attr("fill",n=>t(l.get(n.properties.nom.trim())||0)).attr("stroke","#999").attr("stroke-width",.5).style("opacity",0).on("mouseover",(n,R)=>{const E=R.properties.nom.trim(),D=l.get(E)||0;a.style("opacity",1).html(`
            <div style="font-weight:bold; font-size:15px; margin-bottom:5px;">${E}</div>
            <hr style="margin:5px 0; border:0; border-top:1px solid #eee;">
            <div><strong>Prairies :</strong> ${D}</div>
            <div><strong>Surface :</strong> ${Math.floor(Math.random()*20)} %</div>
            <div><strong>Altitude :</strong> ${Math.floor(Math.random()*600+100)}m</div>
          `),d3.select(n.currentTarget).attr("stroke","#000").attr("stroke-width",1.5).raise()}).on("mousemove",n=>{a.style("left",n.pageX+15+"px").style("top",n.pageY+15+"px")}).on("mouseout",n=>{a.style("opacity",0),d3.select(n.currentTarget).attr("stroke","#999").attr("stroke-width",.5)}).on("click",(n,R)=>V(n,R)).transition().duration(500).style("opacity",1)}function V(e,o){e.stopPropagation(),g.text("← Retour au Département"),x(o,.9),v.selectAll("path").transition().duration(750).style("opacity",i=>i===o?1:.1)}function B(e){w.selectAll("path").transition().duration(500).style("opacity",0).style("pointer-events","none");const o=N.features.filter(t=>s[t.properties.code]===e),i=d3.max(o,t=>l.get(t.properties.nom.trim()))||1,d=d3.scaleSequential().domain([0,i]).interpolator(d3.interpolateGreens);C(i,"Valeur par Dept"),P.selectAll("path").data(o,t=>t.properties.nom).enter().append("path").attr("d",k).style("vector-effect","non-scaling-stroke").attr("fill",t=>d(l.get(t.properties.nom.trim())||0)).attr("stroke","#fff").attr("stroke-width",.5).style("opacity",0).on("mouseover",(t,b)=>{const n=b.properties.nom,R=l.get(n.trim())||0;a.style("opacity",1).html(`
            <div style="font-weight:bold; font-size:15px; margin-bottom:5px;">${n}</div>
            <hr style="margin:5px 0; border:0; border-top:1px solid #eee;">
            <div><strong>Prairies :</strong> ${R}</div>
            <div><strong>Altitude :</strong> ${Math.floor(Math.random()*400+50)}m</div>
          `),d3.select(t.currentTarget).attr("stroke","#000").attr("stroke-width",1.5).raise()}).on("mousemove",t=>{a.style("left",t.pageX+15+"px").style("top",t.pageY+15+"px")}).on("mouseout",t=>{a.style("opacity",0),d3.select(t.currentTarget).attr("stroke","#fff").attr("stroke-width",.5)}).on("click",(t,b)=>T(t,b)).transition().duration(500).style("opacity",1),P.selectAll("path").transition().duration(500).attr("fill",t=>d(l.get(t.properties.nom.trim())||0)).style("opacity",1).style("pointer-events","all")}const S=d3.scaleSequential().domain([0,h]).interpolator(d3.interpolateGreens);C(h,"Valeur par Région"),w.selectAll("path").data(F.features).enter().append("path").attr("d",k).style("vector-effect","non-scaling-stroke").attr("fill",e=>S(l.get(e.properties.nom.trim())||0)).attr("stroke","#fff").attr("stroke-width",1).on("mouseover",(e,o)=>{const i=o.properties.nom,d=l.get(i.trim())||0;a.style("opacity",1).html(`<strong>${i}</strong><br>Prairies : ${d}`),d3.select(e.currentTarget).attr("stroke","#000").attr("stroke-width",1.5).raise()}).on("mousemove",e=>{a.style("left",e.pageX+10+"px").style("top",e.pageY+10+"px")}).on("mouseout",e=>{a.style("opacity",0),d3.select(e.currentTarget).attr("stroke","#fff").attr("stroke-width",1)}).on("click",$)});function C(F,N){c.selectAll(".legend-group").remove();const f=c.append("g").attr("class","legend-group").attr("transform","translate(25, 140)");c.append("defs").append("linearGradient").attr("id","linear-gradient").attr("x1","0%").attr("y1","100%").attr("x2","0%").attr("y2","0%").selectAll("stop").data(d3.range(0,1.1,.1)).enter().append("stop").attr("offset",A=>`${A*100}%`).attr("stop-color",A=>d3.interpolateGreens(A)),f.append("rect").attr("width",20).attr("height",150).style("fill","url(#linear-gradient)");const O=d3.scaleLinear().domain([0,F]).range([150,0]),h=d3.axisRight(O).ticks(5);f.append("g").attr("transform","translate(20, 0)").call(h),f.append("text").attr("y",-10).style("font-size","12px").style("font-weight","bold").text(N)}}window.addEventListener("DOMContentLoaded",()=>{const c=document.getElementById("map-container"),a=c.clientWidth,p=c.clientHeight,u=d3.select("#map").append("svg").attr("width",a).attr("height",p),r=d3.select("#tooltip");j(u,r,a,p)});
